<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>ADMIN</title>
      <link rel="stylesheet" href="/stylesheets/nav.css">
      <link rel="stylesheet" href="/stylesheets/footer.css">
      <link rel="stylesheet" href="/stylesheets/style-slideshow.css">
      <link rel="stylesheet" href="/stylesheets/style-index.css">
      <link rel="stylesheet" href="/stylesheets/style-tutti.css">
      <link rel="stylesheet" href="/stylesheets/style-user.css">
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css">
      <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
      <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
      <script src="javascripts/tutti.js"></script>
</head>

<body>
      <nav class="black">
            <div class="menu-icon">
                  <div class="container" onclick="lol(this)">
                        <div class="bar1"></div>
                        <div class="bar2"></div>
                        <div class="bar3"></div>
                  </div>
            </div>
            <a href="/" class="nascosto"><i class="fas fa-home casa"></i></a>
            <div class="menu">
                  <ul>
                        <li><a href="/Chi_Siamo">Chi Siamo</a></li>
                        <li><a href="/Calendario">Calendario</a></li>
                        <li><a href="/Prenotazione">Prenotazione</a></li>
                        <li id="destra1" style="float:right" class="nascosto2"><a href="/">Home <i
                                          class="fas fa-home"></i></a></li>
                        <li id="destra1" style="float:right"><a href="/Login">Login <i
                                          class="fas fa-sign-in-alt"></i></a></li>
                  </ul>

            </div>
      </nav>
      <div class="wrapper">

            <form action="/upload" method="POST" class="form-container" enctype="multipart/form-data">
                  <h3 class="titolo-primo">AGGIUNGI NOTIZIA</h3>
                  <div class="form-group"><br>
                        <label for="title">Titolo:</label>
                        <input type="text" id="title" name="title" class="form-control" maxlength="80" required>
                  </div>

                  <div class="form-group">
                        <label for="description">Descrizione:</label>
                        <textarea id="description" name="description" class="form-control" maxlength="200" rows="4"
                              required></textarea>
                  </div>

                  <div class="form-group">
                        <label for="image">Immagine:</label>
                        <input type="file" id="image" name="image" class="form-control-file" accept="image/*" required>
                  </div>

                  <button type="submit" class="btn">Invia</button>
            </form>
            <br><br>
            <h3 class="titolo-primo">COME VIENE FUORI</h3><br>
            <div class="slideshow" id="paginated_gallery">
                  <div class="parent" id="gallery_scroller">
                  </div>
                  <a class="bottone right" onclick="avanti()">❯</a>
                  <a class="bottone left" onclick="indietro()">❮</a>
            </div>
            <br><br><br><br>

            <div class="footer">
                  <div>
                        <h1>Staff</h1>
                        <p>Pinco</p>
                        <p>Pallino</p>
                  </div>
                  <div>
                        <h1>Posto</h1>
                        <p>Palazzetto1</p>
                        <p>Palazzetto2</p>
                  </div>
                  <div>
                        <h1>Social</h1>
                        <p><a href="https://www.instagram.com/bluekippe/">bluekippe</a></p>
                        <p>+39 339 3348195</p>
                  </div>
            </div>
      </div>

      <script type="text/javascript">

            var notizie = <%- JSON.stringify(notizie) %>;

            function aggiungiSlide(id, titolo, descrizione, immagine) {
                  const galleryScroller = document.getElementById('gallery_scroller');
                  const newSlide = document.createElement('div');
                  newSlide.classList.add('grid-item');
                  newSlide.dataset.id = id;
                  newSlide.innerHTML = `
                        <img src="data:image/jpeg;base64,${immagine}">
                        <b>${titolo}</b>
                        <p>${descrizione}</p>
                        <button class="elimina-btn">Elimina</button>`;

                  galleryScroller.appendChild(newSlide);
            }

            // Cicla attraverso l'array di oggetti e aggiunge le slide
            notizie.forEach(notizie => {
                  aggiungiSlide(notizie.id, notizie.titolo, notizie.descrizione, notizie.immagine);
            });

            // Aggiungi un listener di evento ai pulsanti di eliminazione
            document.querySelectorAll('.elimina-btn').forEach(button => {
                  button.addEventListener('click', function () {
                        const itemId = this.parentElement.dataset.id;
                        // Invia una richiesta al server per eliminare l'elemento
                        fetch(`/delete/${itemId}`, {
                              method: 'DELETE'
                        })
                              .then(response => {
                                    if (response.ok) {
                                          // Rimuovi l'elemento dal DOM se l'eliminazione è avvenuta con successo
                                          this.parentElement.remove();
                                    } else {
                                          console.error('Errore durante l\'eliminazione dell\'elemento');
                                    }
                              })
                              .catch(error => {
                                    console.error('Errore durante l\'eliminazione dell\'elemento:', error);
                              });
                  });
            });
            
            if (window.matchMedia("(max-width: 767px)").matches) {
                  document.querySelector(".parent").style.gridTemplateColumns = `repeat(${notizie.length}, 70%)`;
            } else {
                  document.querySelector(".parent").style.gridTemplateColumns = `repeat(${notizie.length}, 35%)`;
            }

      </script>
</body>

</html>